// import axios from "axios";
import axios from "@/utils/http";
import store from "@/store";
import { ElMessage } from "element-plus";
// import router from "@/router";

export function userList(data) {
  return axios({
    url: "/api/ifi-personal/user/searchByPage",
    method: "post",
    headers: {
      token: store.state.token,
    },
    data,
  });
}
// 添加响应拦截器
// axios.interceptors.response.use(
//   function (response) {
//     if (response.data.code == 5) {
//       localStorage.removeItem("userId");
//       localStorage.removeItem("token");
//       ElMessage.error("token失效，请重新登录！");
//       router.push("/login");
//     }
//     return response;
//   },
//   function (error) {
//     console.log(error);
//   },
// );

//重置密码
export function resetpsw(data) {
  return axios({
    url: "/api/ifi-personal/user/resetPassword",
    method: "post",
    data,
  })
    .then(function (res) {
      if (res.data.code == 0) {
        ElMessage.success("重置成功!");
      }
    })
    .catch((err) => {
      ElMessage.error(err.message);
    });
}

//删除用户
export function deleteUser(data) {
  return axios({
    url: "/api/ifi-personal/user/deleteUserByIds",
    method: "post",
    data,
  });
}

//获取角色列表
export function roleList(data) {
  return axios({
    url: "/api/ifi-personal/dept/getRoleNameList",
    data,
  });
}

//修改用户角色或者部门
export function sendRoledata(data) {
  return axios({
    url: "/api/ifi-personal/user/updataUserRoleOrDeptInfo",
    method: "post",
    data,
  })
    .then((res) => {
      if (res.data.code == 0) return ElMessage.success("修改成功");
    })
    .catch((err) => {
      ElMessage.error(err);
    });
}

//查询部门常用审批流程
export function getCommonDept() {
  return axios({
    url: "/api/ifi-personal/valueEventFlow/selectDeptFlow",
  });
}

//查询人事常用审批流程
export function getCommonHr() {
  return axios({
    url: "/api/ifi-personal/valueEventFlow/selectHrFlow",
  });
}

//保存部门审批流程
export function saveCommonDept(data) {
  return axios({
    url: "/api/ifi-personal/valueEventFlow/createDeptFlow",
    method: "post",
    data,
  });
}

//保存人事审批流程
export function saveCommonHr(data) {
  return axios({
    url: "/api/ifi-personal/valueEventFlow/createHRFlow",
    method: "post",
    data,
  });
}

//删除审批
export function deleteDeptCommon(data) {
  return axios({
    url: "/api/ifi-personal/valueEventFlow/deleteDeptFlowAndRule",
    method: "delete",
    data,
  });
}

export function deleteHrCommon(data) {
  return axios({
    url: "/api/ifi-personal/valueEventFlow/deleteHRFlowAndRule",
    method: "delete",
    data,
  });
}

//查询新增审批流程有权限的用户
export function getDeptFlow() {
  return axios({
    url: "/api/ifi-personal/user/selectDeptFlowApprover",
    method: "post",
  });
}
export function getHrFlow() {
  return axios({
    url: "/api/ifi-personal/user/selectHrFlowApprover",
    method: "post",
  });
}
//获取用户个人信息
export function getInfo() {
  return axios({
    url: "/api/ifi-personal/user/selectUserByUserId",
    method: "post",
  });
}
//修改电话号码
export function changeInfo(data) {
  return axios({
    url: "/api/ifi-personal/user/upadateUserInfoByUserId",
    method: "post",
    data,
  })
    .then((res) => {
      if (res.data && res.data.code == 0) {
        ElMessage.success("修改成功");
      }
    })
    .catch(() => {
      ElMessage.error("修改失败");
    });
}

//新增用户
export function addUser(data) {
  return axios({
    url: "/api/ifi-personal/user/addUser",
    method: "post",
    data,
  });
}
